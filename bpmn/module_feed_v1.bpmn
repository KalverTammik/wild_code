<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  id="Definitions_ModuleFeed_V1"
                  targetNamespace="http://example.com/bpmn/modulefeed">
  <bpmn:collaboration id="Collaboration_ModuleFeed">
    <bpmn:participant id="Participant_QGIS" name="QGIS Plugin (internal, automated)" processRef="Process_QGIS"/>
    <bpmn:participant id="Participant_API" name="External Services (GraphQL API)" processRef="Process_API"/>
    <!-- Message Flows between FeedLogic ServiceTask and API -->
    <bpmn:messageFlow id="MessageFlow_QueryNextBatch" name="QueryNextBatch" sourceRef="Task_FetchNextBatch" targetRef="Task_API_NextBatch"/>
    <bpmn:messageFlow id="MessageFlow_ItemsBatch" name="ItemsBatch" sourceRef="Task_API_NextBatch" targetRef="Task_FetchNextBatch"/>
  </bpmn:collaboration>

  <!-- QGIS Plugin Process -->
  <bpmn:process id="Process_QGIS" name="Module Feed" isExecutable="false">
    <bpmn:laneSet id="LaneSet_QGIS">
      <bpmn:lane id="Lane_UserScroll" name="User / ScrollBar">
        <bpmn:flowNodeRef>Event_Scroll</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_ModuleBaseUI" name="ModuleBaseUI / Module UIs">
        <bpmn:flowNodeRef>Task_Init</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_UIProgressiveInsert</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_InsertCard</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_FeedLoadEngine" name="FeedLoadEngine">
        <bpmn:flowNodeRef>Task_BufferExtend</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_StartProgInsert</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_ProgNext</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BufferDrip</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_ScheduleLoad</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_LoadGuard</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BufferExtend2</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_StartProgInsert2</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_FeedLogic" name="FeedLogic">
        <bpmn:flowNodeRef>Task_FetchNextBatch</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_FetchNextBatch2</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_ModuleFeedBuilder" name="ModuleFeedBuilder">
        <bpmn:flowNodeRef>Task_CreateCard</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_ThemeManager" name="ThemeManager">
        <bpmn:flowNodeRef>Task_ApplyTheme</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>

    <!-- Data Objects (declared) -->
    <bpmn:dataObject id="Data_Items" name="Items[]"/>
    <bpmn:dataObject id="Data_Buffer" name="Buffer[]"/>
    <bpmn:dataObject id="Data_ViewportState" name="ViewportState"/>
    <bpmn:dataObject id="Data_CardWidget" name="CardWidget (QWidget)"/>
    <bpmn:dataObject id="Data_ThemeSpec" name="ThemeSpec"/>
    <bpmn:dataStoreReference id="Store_FeedConfig" name="FeedConfig"/>

    <!-- Flow Nodes -->
    <bpmn:startEvent id="Start_Activated" name="Module Activated">
      <bpmn:outgoing>Flow_Start_Init</bpmn:outgoing>
    </bpmn:startEvent>

    <bpmn:task id="Task_Init" name="Init (bind scroller, link FE)">
      <bpmn:incoming>Flow_Start_Init</bpmn:incoming>
      <bpmn:outgoing>Flow_Init_HasEngine</bpmn:outgoing>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_ViewportState</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>

    <bpmn:exclusiveGateway id="Gateway_HasFeedEngine" name="Has Feed Engine?">
      <bpmn:incoming>Flow_Init_HasEngine</bpmn:incoming>
      <bpmn:outgoing>Flow_HasEngine_Yes</bpmn:outgoing>
      <bpmn:outgoing>Flow_HasEngine_No</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- (Optional) Legacy branch collapsed -->
    <bpmn:subProcess id="SubProcess_Legacy" name="Legacy Flow" triggeredByEvent="false">
      <bpmn:incoming>Flow_HasEngine_No</bpmn:incoming>
      <bpmn:outgoing>Flow_Legacy_To_End</bpmn:outgoing>
    </bpmn:subProcess>

    <!-- Initial Load -->
    <bpmn:serviceTask id="Task_FetchNextBatch" name="Fetch Next Batch (FeedLogic)">
      <bpmn:incoming>Flow_HasEngine_Yes</bpmn:incoming>
      <bpmn:outgoing>Flow_Fetch_BufferExtend</bpmn:outgoing>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_Items</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
      <bpmn:boundaryEvent id="BoundaryError_Fetch" attachedToRef="Task_FetchNextBatch">
        <bpmn:errorEventDefinition/>
      </bpmn:boundaryEvent>
    </bpmn:serviceTask>

    <bpmn:task id="Task_BufferExtend" name="BufferExtend (+= Items)">
      <bpmn:incoming>Flow_Fetch_BufferExtend</bpmn:incoming>
      <bpmn:outgoing>Flow_BufferExtend_StartProg</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Data_Items</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_Buffer</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>

    <bpmn:task id="Task_StartProgInsert" name="Start Progressive Insert">
      <bpmn:incoming>Flow_BufferExtend_StartProg</bpmn:incoming>
      <bpmn:outgoing>Flow_StartProg_ProgNext</bpmn:outgoing>
      <bpmn:boundaryEvent id="BoundaryTimer_ProgTick" name="tick X ms" attachedToRef="Task_StartProgInsert">
        <bpmn:timerEventDefinition/>
      </bpmn:boundaryEvent>
    </bpmn:task>

    <bpmn:task id="Task_ProgNext" name="ProgNext (pop one from Buffer)">
      <bpmn:incoming>Flow_StartProg_ProgNext</bpmn:incoming>
      <bpmn:outgoing>Flow_ProgNext_UIInsert</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Data_Buffer</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
    </bpmn:task>

    <!-- Build & Insert -->
    <bpmn:task id="Task_UIProgressiveInsert" name="UIProgressiveInsert (choose pos, limits)">
      <bpmn:incoming>Flow_ProgNext_UIInsert</bpmn:incoming>
      <bpmn:incoming>Flow_BufferDrip_To_UIInsert</bpmn:incoming>
      <bpmn:outgoing>Flow_UIInsert_CreateCard</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Data_ViewportState</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_ViewportState</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
      <bpmn:boundaryEvent id="BoundaryCancel_UIInsert" name="Cancel (view closed)" attachedToRef="Task_UIProgressiveInsert">
        <bpmn:cancelEventDefinition/>
      </bpmn:boundaryEvent>
    </bpmn:task>

    <bpmn:task id="Task_CreateCard" name="CreateCard (ModuleFeedBuilder)">
      <bpmn:incoming>Flow_UIInsert_CreateCard</bpmn:incoming>
      <bpmn:outgoing>Flow_CreateCard_ApplyTheme</bpmn:outgoing>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_CardWidget</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>

    <bpmn:task id="Task_ApplyTheme" name="ApplyTheme (idempotent)">
      <bpmn:incoming>Flow_CreateCard_ApplyTheme</bpmn:incoming>
      <bpmn:outgoing>Flow_ApplyTheme_InsertCard</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Data_ThemeSpec</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
    </bpmn:task>

    <bpmn:task id="Task_InsertCard" name="InsertCard (+ViewportState)">
      <bpmn:incoming>Flow_ApplyTheme_InsertCard</bpmn:incoming>
      <bpmn:outgoing>Flow_InsertCard_To_ScrollGateway</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Data_CardWidget</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_ViewportState</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>

    <!-- Scroll-driven refill -->
    <bpmn:intermediateCatchEvent id="Event_Scroll" name="Scroll (valueChanged/rangeChanged)">
      <bpmn:outgoing>Flow_Scroll_To_ScrollGateway</bpmn:outgoing>
      <bpmn:messageEventDefinition/>
    </bpmn:intermediateCatchEvent>

    <bpmn:exclusiveGateway id="Gateway_NearBottom" name="Near-bottom?">
      <bpmn:incoming>Flow_InsertCard_To_ScrollGateway</bpmn:incoming>
      <bpmn:incoming>Flow_Scroll_To_ScrollGateway</bpmn:incoming>
      <bpmn:outgoing>Flow_Gateway_To_BufferDrip</bpmn:outgoing>
      <bpmn:outgoing>Flow_Gateway_To_ScheduleLoad</bpmn:outgoing>
      <bpmn:documentation>ViewportState.scrollPos + margin â‰¥ maxScroll - threshold</bpmn:documentation>
    </bpmn:exclusiveGateway>

    <!-- A-branch -->
    <bpmn:task id="Task_BufferDrip" name="BufferDrip (_progressive_insert_next)">
      <bpmn:incoming>Flow_Gateway_To_BufferDrip</bpmn:incoming>
      <bpmn:outgoing>Flow_BufferDrip_To_UIInsert</bpmn:outgoing>
    </bpmn:task>

    <!-- B-branch -->
    <bpmn:task id="Task_ScheduleLoad" name="ScheduleLoad (debounced)">
      <bpmn:incoming>Flow_Gateway_To_ScheduleLoad</bpmn:incoming>
      <bpmn:outgoing>Flow_ScheduleLoad_LoadGuard</bpmn:outgoing>
    </bpmn:task>

    <bpmn:task id="Task_LoadGuard" name="LoadGuard (alreadyLoading? backoff?)">
      <bpmn:incoming>Flow_ScheduleLoad_LoadGuard</bpmn:incoming>
      <bpmn:outgoing>Flow_LoadGuard_Fetch2</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Store_FeedConfig</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
    </bpmn:task>

    <bpmn:serviceTask id="Task_FetchNextBatch2" name="Fetch Next Batch (2)">
      <bpmn:incoming>Flow_LoadGuard_Fetch2</bpmn:incoming>
      <bpmn:outgoing>Flow_Fetch2_BufferExtend2</bpmn:outgoing>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_Items</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
      <bpmn:boundaryEvent id="BoundaryError_Fetch2" attachedToRef="Task_FetchNextBatch2">
        <bpmn:errorEventDefinition/>
      </bpmn:boundaryEvent>
    </bpmn:serviceTask>

    <bpmn:task id="Task_BufferExtend2" name="BufferExtend (2)">
      <bpmn:incoming>Flow_Fetch2_BufferExtend2</bpmn:incoming>
      <bpmn:outgoing>Flow_BufferExtend2_StartProg2</bpmn:outgoing>
      <bpmn:dataInputAssociation>
        <bpmn:sourceRef>Data_Items</bpmn:sourceRef>
      </bpmn:dataInputAssociation>
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>Data_Buffer</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>

    <bpmn:task id="Task_StartProgInsert2" name="Start Progressive Insert (2)">
      <bpmn:incoming>Flow_BufferExtend2_StartProg2</bpmn:incoming>
      <bpmn:outgoing>Flow_StartProg2_ProgNext</bpmn:outgoing>
    </bpmn:task>

    <!-- Loop back into ProgNext -->
    <bpmn:sequenceFlow id="Flow_Start_Init" sourceRef="Start_Activated" targetRef="Task_Init"/>
    <bpmn:sequenceFlow id="Flow_Init_HasEngine" sourceRef="Task_Init" targetRef="Gateway_HasFeedEngine"/>
    <bpmn:sequenceFlow id="Flow_HasEngine_Yes" sourceRef="Gateway_HasFeedEngine" targetRef="Task_FetchNextBatch"/>
    <bpmn:sequenceFlow id="Flow_HasEngine_No" sourceRef="Gateway_HasFeedEngine" targetRef="SubProcess_Legacy"/>
    <bpmn:sequenceFlow id="Flow_Legacy_To_End" sourceRef="SubProcess_Legacy" targetRef="End_Stable"/>

    <bpmn:sequenceFlow id="Flow_Fetch_BufferExtend" sourceRef="Task_FetchNextBatch" targetRef="Task_BufferExtend"/>
    <bpmn:sequenceFlow id="Flow_BufferExtend_StartProg" sourceRef="Task_BufferExtend" targetRef="Task_StartProgInsert"/>
    <bpmn:sequenceFlow id="Flow_StartProg_ProgNext" sourceRef="Task_StartProgInsert" targetRef="Task_ProgNext"/>
    <bpmn:sequenceFlow id="Flow_ProgNext_UIInsert" sourceRef="Task_ProgNext" targetRef="Task_UIProgressiveInsert"/>
    <bpmn:sequenceFlow id="Flow_UIInsert_CreateCard" sourceRef="Task_UIProgressiveInsert" targetRef="Task_CreateCard"/>
    <bpmn:sequenceFlow id="Flow_CreateCard_ApplyTheme" sourceRef="Task_CreateCard" targetRef="Task_ApplyTheme"/>
    <bpmn:sequenceFlow id="Flow_ApplyTheme_InsertCard" sourceRef="Task_ApplyTheme" targetRef="Task_InsertCard"/>
    <bpmn:sequenceFlow id="Flow_InsertCard_To_ScrollGateway" sourceRef="Task_InsertCard" targetRef="Gateway_NearBottom"/>

    <bpmn:sequenceFlow id="Flow_Scroll_To_ScrollGateway" sourceRef="Event_Scroll" targetRef="Gateway_NearBottom"/>
    <bpmn:sequenceFlow id="Flow_Gateway_To_BufferDrip" sourceRef="Gateway_NearBottom" targetRef="Task_BufferDrip"/>
    <bpmn:sequenceFlow id="Flow_BufferDrip_To_UIInsert" sourceRef="Task_BufferDrip" targetRef="Task_UIProgressiveInsert"/>

    <bpmn:sequenceFlow id="Flow_Gateway_To_ScheduleLoad" sourceRef="Gateway_NearBottom" targetRef="Task_ScheduleLoad"/>
    <bpmn:sequenceFlow id="Flow_ScheduleLoad_LoadGuard" sourceRef="Task_ScheduleLoad" targetRef="Task_LoadGuard"/>
    <bpmn:sequenceFlow id="Flow_LoadGuard_Fetch2" sourceRef="Task_LoadGuard" targetRef="Task_FetchNextBatch2"/>
    <bpmn:sequenceFlow id="Flow_Fetch2_BufferExtend2" sourceRef="Task_FetchNextBatch2" targetRef="Task_BufferExtend2"/>
    <bpmn:sequenceFlow id="Flow_BufferExtend2_StartProg2" sourceRef="Task_BufferExtend2" targetRef="Task_StartProgInsert2"/>
    <bpmn:sequenceFlow id="Flow_StartProg2_ProgNext" sourceRef="Task_StartProgInsert2" targetRef="Task_ProgNext"/>

    <bpmn:endEvent id="End_Stable" name="Stable/Idle">
      <bpmn:incoming>Flow_Legacy_To_End</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>

  <!-- API Process (simplified) -->
  <bpmn:process id="Process_API" name="GraphQL API" isExecutable="false">
    <bpmn:startEvent id="Start_API" name="API Start">
      <bpmn:outgoing>Flow_API_Start_Task</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:task id="Task_API_NextBatch" name="Handle NextBatch Request">
      <bpmn:incoming>Flow_API_Start_Task</bpmn:incoming>
      <bpmn:outgoing>Flow_API_Task_End</bpmn:outgoing>
    </bpmn:task>
    <bpmn:endEvent id="End_API" name="API End">
      <bpmn:incoming>Flow_API_Task_End</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_API_Start_Task" sourceRef="Start_API" targetRef="Task_API_NextBatch"/>
    <bpmn:sequenceFlow id="Flow_API_Task_End" sourceRef="Task_API_NextBatch" targetRef="End_API"/>
  </bpmn:process>

  <!-- BPMN DI -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_ModuleFeed">
    <bpmndi:BPMNPlane id="BPMNPlane_ModuleFeed" bpmnElement="Collaboration_ModuleFeed">
      <!-- Participants -->
      <bpmndi:BPMNShape id="Shape_Participant_QGIS" bpmnElement="Participant_QGIS">
        <dc:Bounds x="100" y="60" width="1600" height="600"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Participant_API" bpmnElement="Participant_API">
        <dc:Bounds x="100" y="700" width="1600" height="200"/>
      </bpmndi:BPMNShape>

      <!-- Lanes (stacked inside QGIS participant) -->
      <bpmndi:BPMNShape id="Shape_Lane_UserScroll" bpmnElement="Lane_UserScroll" isHorizontal="true">
        <dc:Bounds x="130" y="60" width="1550" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Lane_ModuleBaseUI" bpmnElement="Lane_ModuleBaseUI" isHorizontal="true">
        <dc:Bounds x="130" y="140" width="1550" height="120"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Lane_FeedLoadEngine" bpmnElement="Lane_FeedLoadEngine" isHorizontal="true">
        <dc:Bounds x="130" y="260" width="1550" height="140"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Lane_FeedLogic" bpmnElement="Lane_FeedLogic" isHorizontal="true">
        <dc:Bounds x="130" y="400" width="1550" height="120"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Lane_ModuleFeedBuilder" bpmnElement="Lane_ModuleFeedBuilder" isHorizontal="true">
        <dc:Bounds x="130" y="520" width="1550" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Lane_ThemeManager" bpmnElement="Lane_ThemeManager" isHorizontal="true">
        <dc:Bounds x="130" y="590" width="1550" height="70"/>
      </bpmndi:BPMNShape>

      <!-- QGIS Nodes -->
      <bpmndi:BPMNShape id="Shape_Start_Activated" bpmnElement="Start_Activated">
        <dc:Bounds x="170" y="180" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_Init" bpmnElement="Task_Init">
        <dc:Bounds x="240" y="165" width="150" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Gateway_HasFeedEngine" bpmnElement="Gateway_HasFeedEngine" isMarkerVisible="true">
        <dc:Bounds x="420" y="178" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Shape_Task_FetchNextBatch" bpmnElement="Task_FetchNextBatch">
        <dc:Bounds x="510" y="425" width="170" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_BufferExtend" bpmnElement="Task_BufferExtend">
        <dc:Bounds x="700" y="295" width="170" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_StartProgInsert" bpmnElement="Task_StartProgInsert">
        <dc:Bounds x="900" y="295" width="170" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_ProgNext" bpmnElement="Task_ProgNext">
        <dc:Bounds x="1090" y="295" width="170" height="70"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Shape_Task_UIProgressiveInsert" bpmnElement="Task_UIProgressiveInsert">
        <dc:Bounds x="1280" y="165" width="180" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_CreateCard" bpmnElement="Task_CreateCard">
        <dc:Bounds x="1480" y="525" width="170" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_ApplyTheme" bpmnElement="Task_ApplyTheme">
        <dc:Bounds x="1480" y="600" width="170" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_InsertCard" bpmnElement="Task_InsertCard">
        <dc:Bounds x="1480" y="185" width="170" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Shape_Event_Scroll" bpmnElement="Event_Scroll">
        <dc:Bounds x="250" y="95" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Gateway_NearBottom" bpmnElement="Gateway_NearBottom" isMarkerVisible="true">
        <dc:Bounds x="1380" y="90" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Shape_Task_BufferDrip" bpmnElement="Task_BufferDrip">
        <dc:Bounds x="1460" y="80" width="150" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_ScheduleLoad" bpmnElement="Task_ScheduleLoad">
        <dc:Bounds x="1240" y="80" width="120" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_LoadGuard" bpmnElement="Task_LoadGuard">
        <dc:Bounds x="1100" y="80" width="120" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_FetchNextBatch2" bpmnElement="Task_FetchNextBatch2">
        <dc:Bounds x="960" y="425" width="170" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_BufferExtend2" bpmnElement="Task_BufferExtend2">
        <dc:Bounds x="1140" y="425" width="170" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_StartProgInsert2" bpmnElement="Task_StartProgInsert2">
        <dc:Bounds x="1320" y="425" width="170" height="70"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Shape_End_Stable" bpmnElement="End_Stable">
        <dc:Bounds x="610" y="185" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- API Nodes -->
      <bpmndi:BPMNShape id="Shape_Start_API" bpmnElement="Start_API">
        <dc:Bounds x="300" y="760" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_Task_API_NextBatch" bpmnElement="Task_API_NextBatch">
        <dc:Bounds x="380" y="745" width="200" height="70"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_End_API" bpmnElement="End_API">
        <dc:Bounds x="610" y="760" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- Sequence Flow Edges (only key ones to render paths) -->
      <bpmndi:BPMNEdge id="Edge_Flow_Start_Init" bpmnElement="Flow_Start_Init">
        <di:waypoint x="206" y="198"/>
        <di:waypoint x="240" y="200"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_Init_HasEngine" bpmnElement="Flow_Init_HasEngine">
        <di:waypoint x="390" y="200"/>
        <di:waypoint x="420" y="203"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_HasEngine_Yes" bpmnElement="Flow_HasEngine_Yes">
        <di:waypoint x="445" y="203"/>
        <di:waypoint x="510" y="460"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_Fetch_BufferExtend" bpmnElement="Flow_Fetch_BufferExtend">
        <di:waypoint x="680" y="460"/>
        <di:waypoint x="700" y="330"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_BufferExtend_StartProg" bpmnElement="Flow_BufferExtend_StartProg">
        <di:waypoint x="870" y="330"/>
        <di:waypoint x="900" y="330"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_StartProg_ProgNext" bpmnElement="Flow_StartProg_ProgNext">
        <di:waypoint x="1070" y="330"/>
        <di:waypoint x="1090" y="330"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_ProgNext_UIInsert" bpmnElement="Flow_ProgNext_UIInsert">
        <di:waypoint x="1260" y="330"/>
        <di:waypoint x="1280" y="200"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_UIInsert_CreateCard" bpmnElement="Flow_UIInsert_CreateCard">
        <di:waypoint x="1460" y="200"/>
        <di:waypoint x="1480" y="550"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_CreateCard_ApplyTheme" bpmnElement="Flow_CreateCard_ApplyTheme">
        <di:waypoint x="1650" y="550"/>
        <di:waypoint x="1650" y="625"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_ApplyTheme_InsertCard" bpmnElement="Flow_ApplyTheme_InsertCard">
        <di:waypoint x="1650" y="625"/>
        <di:waypoint x="1650" y="210"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_InsertCard_To_ScrollGateway" bpmnElement="Flow_InsertCard_To_ScrollGateway">
        <di:waypoint x="1480" y="210"/>
        <di:waypoint x="1405" y="115"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_Scroll_To_ScrollGateway" bpmnElement="Flow_Scroll_To_ScrollGateway">
        <di:waypoint x="286" y="113"/>
        <di:waypoint x="1380" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Edge_Flow_Gateway_To_BufferDrip" bpmnElement="Flow_Gateway_To_BufferDrip">
        <di:waypoint x="1430" y="115"/>
        <di:waypoint x="1460" y="115"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_BufferDrip_To_UIInsert" bpmnElement="Flow_BufferDrip_To_UIInsert">
        <di:waypoint x="1610" y="115"/>
        <di:waypoint x="1380" y="200"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Edge_Flow_Gateway_To_ScheduleLoad" bpmnElement="Flow_Gateway_To_ScheduleLoad">
        <di:waypoint x="1380" y="115"/>
        <di:waypoint x="1240" y="115"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_ScheduleLoad_LoadGuard" bpmnElement="Flow_ScheduleLoad_LoadGuard">
        <di:waypoint x="1240" y="115"/>
        <di:waypoint x="1100" y="115"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_LoadGuard_Fetch2" bpmnElement="Flow_LoadGuard_Fetch2">
        <di:waypoint x="1100" y="115"/>
        <di:waypoint x="1045" y="425"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_Fetch2_BufferExtend2" bpmnElement="Flow_Fetch2_BufferExtend2">
        <di:waypoint x="1130" y="460"/>
        <di:waypoint x="1140" y="460"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_BufferExtend2_StartProg2" bpmnElement="Flow_BufferExtend2_StartProg2">
        <di:waypoint x="1310" y="460"/>
        <di:waypoint x="1320" y="460"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_Flow_StartProg2_ProgNext" bpmnElement="Flow_StartProg2_ProgNext">
        <di:waypoint x="1490" y="460"/>
        <di:waypoint x="1175" y="330"/>
      </bpmndi:BPMNEdge>

      <!-- Message Flows DI -->
      <bpmndi:BPMNEdge id="Edge_MessageFlow_QueryNextBatch" bpmnElement="MessageFlow_QueryNextBatch">
        <di:waypoint x="595" y="460"/>
        <di:waypoint x="480" y="745"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_MessageFlow_ItemsBatch" bpmnElement="MessageFlow_ItemsBatch">
        <di:waypoint x="580" y="745"/>
        <di:waypoint x="595" y="460"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
