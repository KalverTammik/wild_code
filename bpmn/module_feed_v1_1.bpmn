<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:open-bpmn="http://open-bpmn.org/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_ModuleFeed_V12" targetNamespace="http://example.com/bpmn/modulefeed">
  <bpmn:extensionElements>
    <open-bpmn:auto-align/>
  </bpmn:extensionElements>
  <bpmn:process id="Process_QGIS" isExecutable="false" name="Module Feed" processType="Public">
    <!-- Main flow -->
    <bpmn:startEvent id="Start_Activated" name="Module Activated">
      <bpmn:outgoing>Flow_Start_Init</bpmn:outgoing>
      <bpmn:documentation id="documentation_baWUfA"/>
    </bpmn:startEvent>
    <bpmn:task id="Task_Init" name="Init (bind scroller, link FE)">
      <bpmn:incoming>Flow_Start_Init</bpmn:incoming>
      <bpmn:outgoing>Flow_Init_End</bpmn:outgoing>
      <bpmn:documentation id="documentation_AV46Og"/>
    </bpmn:task>
    <bpmn:endEvent id="End_Ready" name="Ready">
      <bpmn:incoming>Flow_Init_End</bpmn:incoming>
      <bpmn:documentation id="documentation_0upf8Q"/>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_Start_Init" sourceRef="Start_Activated" targetRef="Task_Init">
      <bpmn:documentation id="documentation_lOJa7w"/>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Init_End" sourceRef="Task_Init" targetRef="End_Ready">
      <bpmn:documentation id="documentation_73z8Jw"/>
    </bpmn:sequenceFlow>
    <!-- Event SubProcess A: Scroll/Timer driven load -->
    <bpmn:subProcess id="SubProcess_ScrollTimer" name="Scroll/Timer Driven Load" triggeredByEvent="true">
      <bpmn:startEvent id="Start_ScrollEvent" isInterrupting="false" name="Scroll Event">
        <bpmn:messageEventDefinition/>
        <bpmn:outgoing>Flow_Scroll_To_Gateway</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:startEvent id="Start_DripTimer" isInterrupting="false" name="Drip Timer">
        <bpmn:timerEventDefinition/>
        <bpmn:outgoing>Flow_Timer_To_Gateway</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:exclusiveGateway id="Gateway_NearBottom" name="Near-bottom?">
        <bpmn:incoming>Flow_Scroll_To_Gateway</bpmn:incoming>
        <bpmn:incoming>Flow_Timer_To_Gateway</bpmn:incoming>
        <bpmn:outgoing>Flow_GW_To_Drip</bpmn:outgoing>
        <bpmn:outgoing>Flow_GW_To_Schedule</bpmn:outgoing>
        <bpmn:documentation>(scrollPos+margin) ≥ (maxScroll−threshold)</bpmn:documentation>
      </bpmn:exclusiveGateway>
      <!-- Drip branch -->
      <bpmn:task id="Task_BufferDrip" name="BufferDrip">
        <bpmn:incoming>Flow_GW_To_Drip</bpmn:incoming>
        <bpmn:outgoing>Flow_Drip_End</bpmn:outgoing>
      </bpmn:task>
      <bpmn:endEvent id="End_Drip" name="Drip Done">
        <bpmn:incoming>Flow_Drip_End</bpmn:incoming>
      </bpmn:endEvent>
      <!-- Load branch -->
      <bpmn:task id="Task_ScheduleLoad" name="ScheduleLoad">
        <bpmn:incoming>Flow_GW_To_Schedule</bpmn:incoming>
        <bpmn:outgoing>Flow_Schedule_Guard</bpmn:outgoing>
      </bpmn:task>
      <bpmn:task id="Task_LoadGuard" name="LoadGuard">
        <bpmn:incoming>Flow_Schedule_Guard</bpmn:incoming>
        <bpmn:outgoing>Flow_Guard_Fetch</bpmn:outgoing>
      </bpmn:task>
      <bpmn:serviceTask id="Task_FetchNextBatch" name="FetchNextBatch">
        <bpmn:incoming>Flow_Guard_Fetch</bpmn:incoming>
        <bpmn:outgoing>Flow_Fetch_BufferExtend</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:task id="Task_BufferExtend" name="BufferExtend">
        <bpmn:incoming>Flow_Fetch_BufferExtend</bpmn:incoming>
        <bpmn:outgoing>Flow_Buffer_StartProg</bpmn:outgoing>
      </bpmn:task>
      <bpmn:task id="Task_StartProgInsert" name="StartProgInsert">
        <bpmn:incoming>Flow_Buffer_StartProg</bpmn:incoming>
        <bpmn:outgoing>Flow_Prog_End</bpmn:outgoing>
      </bpmn:task>
      <bpmn:endEvent id="End_Load" name="Load Done">
        <bpmn:incoming>Flow_Prog_End</bpmn:incoming>
      </bpmn:endEvent>
      <!-- Sequence Flows inside SubProcess A -->
      <bpmn:sequenceFlow id="Flow_Scroll_To_Gateway" sourceRef="Start_ScrollEvent" targetRef="Gateway_NearBottom"/>
      <bpmn:sequenceFlow id="Flow_Timer_To_Gateway" sourceRef="Start_DripTimer" targetRef="Gateway_NearBottom"/>
      <bpmn:sequenceFlow id="Flow_GW_To_Drip" sourceRef="Gateway_NearBottom" targetRef="Task_BufferDrip"/>
      <bpmn:sequenceFlow id="Flow_Drip_End" sourceRef="Task_BufferDrip" targetRef="End_Drip"/>
      <bpmn:sequenceFlow id="Flow_GW_To_Schedule" sourceRef="Gateway_NearBottom" targetRef="Task_ScheduleLoad"/>
      <bpmn:sequenceFlow id="Flow_Schedule_Guard" sourceRef="Task_ScheduleLoad" targetRef="Task_LoadGuard"/>
      <bpmn:sequenceFlow id="Flow_Guard_Fetch" sourceRef="Task_LoadGuard" targetRef="Task_FetchNextBatch"/>
      <bpmn:sequenceFlow id="Flow_Fetch_BufferExtend" sourceRef="Task_FetchNextBatch" targetRef="Task_BufferExtend"/>
      <bpmn:sequenceFlow id="Flow_Buffer_StartProg" sourceRef="Task_BufferExtend" targetRef="Task_StartProgInsert"/>
      <bpmn:sequenceFlow id="Flow_Prog_End" sourceRef="Task_StartProgInsert" targetRef="End_Load"/>
      <bpmn:documentation id="documentation_p0Vp0w"/>
    </bpmn:subProcess>
    <!-- Event SubProcess B: Interrupting Deactivation -->
    <bpmn:subProcess id="SubProcess_Deactivation" name="Module Deactivation" triggeredByEvent="true">
      <bpmn:startEvent id="Start_ModuleDeactivated" name="Module Deactivated">
        <bpmn:messageEventDefinition/>
        <bpmn:outgoing>Flow_Deact_Terminate</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:endEvent id="End_Terminate" name="Terminate">
        <bpmn:terminateEventDefinition/>
        <bpmn:incoming>Flow_Deact_Terminate</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_Deact_Terminate" sourceRef="Start_ModuleDeactivated" targetRef="End_Terminate"/>
      <bpmn:documentation id="documentation_7hXR9g"/>
    </bpmn:subProcess>
    <!-- Event SubProcess C: Non-interrupting Error handler -->
    <bpmn:subProcess id="SubProcess_ErrorHandler" name="API Error Handler" triggeredByEvent="true">
      <bpmn:startEvent id="Start_APIError" isInterrupting="false" name="API Error">
        <bpmn:errorEventDefinition/>
        <bpmn:outgoing>Flow_Error_Show</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:task id="Task_ShowEmptyState" name="ShowEmptyState">
        <bpmn:incoming>Flow_Error_Show</bpmn:incoming>
        <bpmn:outgoing>Flow_Show_End</bpmn:outgoing>
      </bpmn:task>
      <bpmn:endEvent id="End_ErrorHandled" name="ErrorHandled">
        <bpmn:incoming>Flow_Show_End</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_Error_Show" sourceRef="Start_APIError" targetRef="Task_ShowEmptyState"/>
      <bpmn:sequenceFlow id="Flow_Show_End" sourceRef="Task_ShowEmptyState" targetRef="End_ErrorHandled"/>
      <bpmn:documentation id="documentation_Y0BT9Q"/>
    </bpmn:subProcess>
    <!-- Data Objects -->
    <bpmn:dataObject id="Data_Items" name="Items[]">
      <bpmn:documentation id="documentation_EptqbQ"/>
    </bpmn:dataObject>
    <bpmn:dataObject id="Data_Buffer" name="Buffer[]">
      <bpmn:documentation id="documentation_UgZh8A"/>
    </bpmn:dataObject>
    <bpmn:dataObject id="Data_ViewportState" name="ViewportState">
      <bpmn:documentation id="documentation_kCePcg"/>
    </bpmn:dataObject>
    <bpmn:dataObject id="Data_CardWidget" name="CardWidget">
      <bpmn:documentation id="documentation_Qc9fpg"/>
    </bpmn:dataObject>
    <bpmn:dataObject id="Data_ThemeSpec" name="ThemeSpec">
      <bpmn:documentation id="documentation_YJbT0A"/>
    </bpmn:dataObject>
    <bpmn:dataStoreReference id="Store_FeedConfig" name="FeedConfig">
      <bpmn:documentation id="documentation_brZKxA"/>
    </bpmn:dataStoreReference>
    <bpmn:documentation id="documentation_3V0Suw"/>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1" name="OpenBPMN Diagram">
    <bpmndi:BPMNPlane bpmnElement="Process_QGIS" id="BPMNPlane_1">
      <bpmndi:BPMNShape bpmnElement="Start_Activated" id="BPMNShape_TzEshA">
        <dc:Bounds height="36.0" width="36.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_R2gJKA">
          <dc:Bounds height="20.0" width="100.0" x="-32.0" y="39.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Task_Init" id="BPMNShape_NCOmpw">
        <dc:Bounds height="50.0" width="110.0" x="0.0" y="0.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="End_Ready" id="BPMNShape_aiEQww">
        <dc:Bounds height="36.0" width="36.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_xszNuw">
          <dc:Bounds height="20.0" width="100.0" x="-32.0" y="39.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="Flow_Start_Init" id="BPMNEdge_ZdDfJQ">
        <di:waypoint x="800.0" y="18.0"/>
        <di:waypoint x="455.0" y="18.0"/>
        <di:waypoint x="455.0" y="25.0"/>
        <di:waypoint x="110.0" y="25.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="Flow_Init_End" id="BPMNEdge_0fKKcg">
        <di:waypoint x="110.0" y="25.0"/>
        <di:waypoint x="555.0" y="25.0"/>
        <di:waypoint x="555.0" y="18.0"/>
        <di:waypoint x="1000.0" y="18.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape bpmnElement="SubProcess_ScrollTimer" id="BPMNShape_wrijoQ">
        <dc:Bounds height="50.0" width="110.0" x="0.0" y="0.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="SubProcess_Deactivation" id="BPMNShape_F8gljg">
        <dc:Bounds height="50.0" width="110.0" x="0.0" y="0.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="SubProcess_ErrorHandler" id="BPMNShape_X8m5ZQ">
        <dc:Bounds height="50.0" width="110.0" x="0.0" y="0.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Data_Items" id="BPMNShape_amZ4SA">
        <dc:Bounds height="50.0" width="35.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_jUxd0g">
          <dc:Bounds height="20.0" width="100.0" x="-32.5" y="55.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Data_Buffer" id="BPMNShape_mB7ZTg">
        <dc:Bounds height="50.0" width="35.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_2I07XQ">
          <dc:Bounds height="20.0" width="100.0" x="-32.5" y="55.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Data_ViewportState" id="BPMNShape_H3XzJw">
        <dc:Bounds height="50.0" width="35.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_Fb08Xw">
          <dc:Bounds height="20.0" width="100.0" x="-32.5" y="55.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Data_CardWidget" id="BPMNShape_0tAv6A">
        <dc:Bounds height="50.0" width="35.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_ZtqcEw">
          <dc:Bounds height="20.0" width="100.0" x="-32.5" y="55.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Data_ThemeSpec" id="BPMNShape_iHCu6Q">
        <dc:Bounds height="50.0" width="35.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_orxDRA">
          <dc:Bounds height="20.0" width="100.0" x="-32.5" y="55.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Store_FeedConfig" id="BPMNShape_emiPJQ">
        <dc:Bounds height="50.0" width="50.0" x="0.0" y="0.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_xvJirw">
          <dc:Bounds height="20.0" width="100.0" x="-25.0" y="50.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
