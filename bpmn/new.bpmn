<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  id="Defs_KirjadeHaldus"
                  targetNamespace="http://example.com/bpmn/kirjade-haldus">

  <!-- Messages for Message Start Events -->
  <bpmn:message id="Message_Incoming" name="Sissetulev kiri saabub"/>
  <bpmn:message id="Message_FromColleague" name="Kolleeg annab kirja"/>
  <bpmn:message id="Message_OutgoingFromColleague" name="Väljaminev kiri töötajalt"/>

  <!-- Persistent Data Stores (definitions) -->
  <bpmn:dataStore id="DataStoreDef_IncomingExcel" name="Sissetulevate kirjade register (Excel)"/>
  <bpmn:dataStore id="DataStoreDef_OutgoingExcel" name="Väljaminevate kirjade register (Excel)"/>
  <bpmn:dataStore id="DataStoreDef_NDrive" name="Failiserver N:\Osakond\Kirjad"/>

  <!-- Collaboration with 3 Participants (pools) -->
  <bpmn:collaboration id="Collab_KirjadeHaldus">
    <bpmn:participant id="Participant_Assistant" name="Assistent" processRef="Process_Assistant"/>
    <bpmn:participant id="Participant_Colleague" name="Kolleeg (empty pool)"/>
    <bpmn:participant id="Participant_Channel" name="Väline kanal (post/e-post)"/>
    <!-- Message Flows to the assistant's Message Start Events -->
    <bpmn:messageFlow id="MF_Channel_to_StartIncoming"
                      name="Saabuv kiri"
                      sourceRef="Participant_Channel"
                      targetRef="Start_Incoming"/>
    <bpmn:messageFlow id="MF_Colleague_to_StartByColleague"
                      name="Kolleegi palvel"
                      sourceRef="Participant_Colleague"
                      targetRef="Start_ByColleague"/>
    <bpmn:messageFlow id="MF_Colleague_to_StartOutgoing"
                      name="Väljaminev kiri"
                      sourceRef="Participant_Colleague"
                      targetRef="Start_Outgoing"/>
  </bpmn:collaboration>

  <!-- Assistant's Process -->
  <bpmn:process id="Process_Assistant" name="Kirjade haldus (Assistent)" isExecutable="false">

    <!-- Data Store References inside the process -->
    <bpmn:dataStoreReference id="DS_IncomingExcel" name="Sissetulevad (Excel)" dataStoreRef="DataStoreDef_IncomingExcel"/>
    <bpmn:dataStoreReference id="DS_OutgoingExcel" name="Väljaminevad (Excel)" dataStoreRef="DataStoreDef_OutgoingExcel"/>
    <bpmn:dataStoreReference id="DS_NDrive" name="N:\Osakond\Kirjad" dataStoreRef="DataStoreDef_NDrive"/>

    <!-- Path A: Incoming letter arrives via external channel -->
    <bpmn:startEvent id="Start_Incoming" name="Sissetulev kiri saabub">
      <bpmn:messageEventDefinition messageRef="Message_Incoming"/>
    </bpmn:startEvent>
    <bpmn:task id="Task_RegisterIncoming" name="Registreeri Excelis (sissetulev)">
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>DS_IncomingExcel</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>
    <bpmn:task id="Task_CopyToN_Incoming" name="Salvesta koopia N:\ (sissetulev)">
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>DS_NDrive</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>
    <bpmn:endEvent id="End_Incoming" name="Sissetulev kiri registreeritud"/>

    <bpmn:sequenceFlow id="SF_A_1" sourceRef="Start_Incoming" targetRef="Task_RegisterIncoming"/>
    <bpmn:sequenceFlow id="SF_A_2" sourceRef="Task_RegisterIncoming" targetRef="Task_CopyToN_Incoming"/>
    <bpmn:sequenceFlow id="SF_A_3" sourceRef="Task_CopyToN_Incoming" targetRef="End_Incoming"/>

    <!-- Path A2: Colleague brings incoming letter to register (no extra processing) -->
    <bpmn:startEvent id="Start_ByColleague" name="Kolleeg annab kirja">
      <bpmn:messageEventDefinition messageRef="Message_FromColleague"/>
    </bpmn:startEvent>
    <bpmn:task id="Task_RegisterIncoming_A2" name="Registreeri Excelis (sissetulev, kolleegi palvel)">
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>DS_IncomingExcel</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>
    <bpmn:task id="Task_CopyToN_A2" name="Salvesta koopia N:\ (sissetulev, kolleegi palvel)">
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>DS_NDrive</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>
    <bpmn:endEvent id="End_A2" name="Kiri registreeritud (kolleegi palvel)"/>

    <bpmn:sequenceFlow id="SF_A2_1" sourceRef="Start_ByColleague" targetRef="Task_RegisterIncoming_A2"/>
    <bpmn:sequenceFlow id="SF_A2_2" sourceRef="Task_RegisterIncoming_A2" targetRef="Task_CopyToN_A2"/>
    <bpmn:sequenceFlow id="SF_A2_3" sourceRef="Task_CopyToN_A2" targetRef="End_A2"/>

    <!-- Path B: Outgoing letter from colleague/worker -->
    <bpmn:startEvent id="Start_Outgoing" name="Väljaminev kiri töötajalt">
      <bpmn:messageEventDefinition messageRef="Message_OutgoingFromColleague"/>
    </bpmn:startEvent>
    <bpmn:task id="Task_RegisterOutgoing" name="Registreeri Excelis (väljaminev)">
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>DS_OutgoingExcel</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>
    <bpmn:task id="Task_CopyToN_Outgoing" name="Salvesta koopia N:\ (väljaminev)">
      <bpmn:dataOutputAssociation>
        <bpmn:targetRef>DS_NDrive</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:task>
    <bpmn:endEvent id="End_Outgoing" name="Väljaminev kiri registreeritud"/>

    <bpmn:sequenceFlow id="SF_B_1" sourceRef="Start_Outgoing" targetRef="Task_RegisterOutgoing"/>
    <bpmn:sequenceFlow id="SF_B_2" sourceRef="Task_RegisterOutgoing" targetRef="Task_CopyToN_Outgoing"/>
    <bpmn:sequenceFlow id="SF_B_3" sourceRef="Task_CopyToN_Outgoing" targetRef="End_Outgoing"/>

  </bpmn:process>

  <!-- Minimal DI to render pools and main flow nodes. Edges omitted for simplicity; bpmn.io will still open the diagram. -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_KirjadeHaldus">
    <bpmndi:BPMNPlane id="BPMNPlane_KirjadeHaldus" bpmnElement="Collab_KirjadeHaldus">

      <!-- Participants -->
      <bpmndi:BPMNShape id="DI_Part_Assistant" bpmnElement="Participant_Assistant">
        <dc:Bounds x="150" y="60" width="1200" height="480"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Part_Colleague" bpmnElement="Participant_Colleague">
        <dc:Bounds x="150" y="560" width="1200" height="120"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Part_Channel" bpmnElement="Participant_Channel">
        <dc:Bounds x="150" y="-80" width="1200" height="120"/>
      </bpmndi:BPMNShape>

      <!-- Assistant process nodes laid out left -> right in three rows (waterflow) -->
      <bpmndi:BPMNShape id="DI_Start_Incoming" bpmnElement="Start_Incoming">
        <dc:Bounds x="220" y="120" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Task_RegisterIncoming" bpmnElement="Task_RegisterIncoming">
        <dc:Bounds x="300" y="110" width="160" height="56"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Task_CopyToN_Incoming" bpmnElement="Task_CopyToN_Incoming">
        <dc:Bounds x="500" y="110" width="180" height="56"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_End_Incoming" bpmnElement="End_Incoming">
        <dc:Bounds x="720" y="120" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="DI_Start_ByColleague" bpmnElement="Start_ByColleague">
        <dc:Bounds x="220" y="250" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Task_RegisterIncoming_A2" bpmnElement="Task_RegisterIncoming_A2">
        <dc:Bounds x="300" y="240" width="200" height="56"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Task_CopyToN_A2" bpmnElement="Task_CopyToN_A2">
        <dc:Bounds x="540" y="240" width="220" height="56"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_End_A2" bpmnElement="End_A2">
        <dc:Bounds x="800" y="250" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="DI_Start_Outgoing" bpmnElement="Start_Outgoing">
        <dc:Bounds x="220" y="380" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Task_RegisterOutgoing" bpmnElement="Task_RegisterOutgoing">
        <dc:Bounds x="300" y="370" width="190" height="56"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_Task_CopyToN_Outgoing" bpmnElement="Task_CopyToN_Outgoing">
        <dc:Bounds x="530" y="370" width="210" height="56"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_End_Outgoing" bpmnElement="End_Outgoing">
        <dc:Bounds x="780" y="380" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- (Optional) show Data Stores visually -->
      <bpmndi:BPMNShape id="DI_DS_IncomingExcel" bpmnElement="DS_IncomingExcel">
        <dc:Bounds x="950" y="110" width="120" height="60"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_DS_OutgoingExcel" bpmnElement="DS_OutgoingExcel">
        <dc:Bounds x="950" y="370" width="120" height="60"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DI_DS_NDrive" bpmnElement="DS_NDrive">
        <dc:Bounds x="950" y="240" width="160" height="60"/>
      </bpmndi:BPMNShape>

      <!-- Keeping edges minimal to avoid reference issues; the engine can auto-layout flows if needed -->
      <bpmndi:BPMNEdge id="DI_SF_A_1" bpmnElement="SF_A_1">
        <di:waypoint x="256" y="138"/><di:waypoint x="300" y="138"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DI_SF_A_2" bpmnElement="SF_A_2">
        <di:waypoint x="460" y="138"/><di:waypoint x="500" y="138"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DI_SF_A_3" bpmnElement="SF_A_3">
        <di:waypoint x="680" y="138"/><di:waypoint x="720" y="138"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="DI_SF_A2_1" bpmnElement="SF_A2_1">
        <di:waypoint x="256" y="268"/><di:waypoint x="300" y="268"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DI_SF_A2_2" bpmnElement="SF_A2_2">
        <di:waypoint x="500" y="268"/><di:waypoint x="540" y="268"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DI_SF_A2_3" bpmnElement="SF_A2_3">
        <di:waypoint x="760" y="268"/><di:waypoint x="800" y="268"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="DI_SF_B_1" bpmnElement="SF_B_1">
        <di:waypoint x="256" y="398"/><di:waypoint x="300" y="398"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DI_SF_B_2" bpmnElement="SF_B_2">
        <di:waypoint x="490" y="398"/><di:waypoint x="530" y="398"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DI_SF_B_3" bpmnElement="SF_B_3">
        <di:waypoint x="740" y="398"/><di:waypoint x="780" y="398"/>
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
